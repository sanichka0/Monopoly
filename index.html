<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö° –°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –ú–æ–Ω–æ–ø–æ–ª—ñ—è - –ú—É–ª—å—Ç–∏–ø–ª–µ—î—Ä</title>
    <style>
        /* –í—Å—ñ —Å—Ç–∏–ª—ñ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è —Ç–∞–∫–∏–º–∏ –∂, —è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 10px;
        }

        #gameContainer {
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .game-title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #e0e0e0;
            transform: scale(1.1);
        }

        .control-btn.active {
            background: #4CAF50;
            color: white;
        }

        /* –†—è–¥–æ–∫ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è */
        .turn-announcement {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            transition: background-color 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* –Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ */
        .game-board {
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            background: #2c3e50;
            padding: 15px;
            border-radius: 15px;
        }

        .cell {
            aspect-ratio: 1;
            background: white;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .cell:hover {
            transform: scale(1.05);
        }

        .cell-number {
            font-size: 10px;
            color: #666;
            position: absolute;
            top: 2px;
            left: 2px;
        }

        .cell-icon {
            font-size: 24px;
        }

        .cell-reps {
            font-size: 12px;
            font-weight: bold;
            color: #e74c3c;
        }

        .players-on-cell {
            display: flex;
            gap: 2px;
            margin-top: 2px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .player-dot {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ */
        .cell-start { background: #fff9c4; }
        .cell-finish { background: #fff9c4; }
        .cell-turn { background: #b3e5fc; }
        .cell-exercise { background: #ffecb3; }
        .cell-special { background: #ffcdd2; }

        /* –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å */
        .bottom-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* –°–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ */
        .players-list {
            background: #34495e;
            border-radius: 15px;
            padding: 15px;
            color: white;
        }

        .players-list h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 8px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.1);
        }

        .player-item.active {
            background: #2ecc71;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .player-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .player-name {
            flex: 1;
        }

        .player-position {
            font-size: 12px;
            color: #ecf0f1;
        }

        .turn-indicator {
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            margin-left: 5px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        /* –ü–∞–Ω–µ–ª—å –∫—É–±–∏–∫–∞ */
        .dice-panel {
            background: #34495e;
            border-radius: 15px;
            padding: 15px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .dice-face {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            padding: 10px;
            width: 100%;
            height: 100%;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
            place-self: center;
        }

        .dot.empty {
            background: transparent;
        }

        .dice-value {
            font-size: 48px;
            font-weight: bold;
            color: #333;
        }

        .dice-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .dice-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .dice-btn:not(:disabled):hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .last-roll {
            margin: 10px 0;
            font-size: 14px;
            color: #ecf0f1;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .player-info {
            padding: 10px;
            border-radius: 10px;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .player-color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: currentColor;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .exercise-name {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .reps-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .big-number {
            font-size: 72px;
            font-weight: bold;
            color: #e74c3c;
            line-height: 1;
        }

        .unit {
            font-size: 18px;
            color: #7f8c8d;
        }

        .complete-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .complete-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .complete-btn:not(:disabled):hover {
            background: #2ecc71;
        }

        .waiting-message {
            text-align: center;
            padding: 15px;
            background: #f1f2f6;
            border-radius: 10px;
            color: #2c3e50;
            font-size: 16px;
        }

        /* –ï–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ */
        .results-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .results-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .winner-title {
            font-size: 48px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin: 40px 0;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .place-1 { order: 2; }
        .place-2 { order: 1; }
        .place-3 { order: 3; }

        .podium-number {
            font-size: 32px;
            font-weight: bold;
        }

        .podium-name {
            margin-top: 10px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 10px;
            min-width: 150px;
            text-align: center;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .stats-table th,
        .stats-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .stats-table th {
            background: #34495e;
            color: white;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .new-game-btn {
            display: block;
            width: 200px;
            margin: 30px auto 0;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .new-game-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* –ï–∫—Ä–∞–Ω –≤—Ö–æ–¥—É */
        .lobby-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 3000;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lobby-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }

        .lobby-content h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 36px;
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: bold;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option.selected {
            border-color: #2c3e50;
            transform: scale(1.1);
        }

        .color-option.taken {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .lobby-btn {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-btn {
            background: #27ae60;
            color: white;
        }

        .create-btn:hover {
            background: #2ecc71;
        }

        .join-btn {
            background: #3498db;
            color: white;
        }

        .join-btn:hover {
            background: #2980b9;
        }

        .room-code {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .room-code .code {
            font-size: 48px;
            font-weight: bold;
            letter-spacing: 10px;
            color: #2c3e50;
        }

        .copy-btn {
            padding: 10px 20px;
            background: #f1f2f6;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .players-in-room {
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .player-in-room {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 5px;
        }

        .start-btn {
            background: #e74c3c;
            color: white;
            font-size: 20px;
            padding: 20px;
        }

        .start-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        /* –ê—É–¥—ñ–æ –∫–æ–Ω—Ç—Ä–æ–ª */
        .volume-slider {
            position: absolute;
            top: 60px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: none;
        }

        .volume-slider.active {
            display: block;
        }

        /* –ü—Ä–∞–≤–∏–ª–∞ */
        .rules-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 4000;
            display: none;
        }

        .rules-popup.active {
            display: block;
        }

        .rules-popup h2 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .rules-popup p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #f1f2f6;
            border: none;
            cursor: pointer;
        }

        /* –ü–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω */
        :-webkit-full-screen {
            width: 100vw;
            height: 100vh;
        }

        :-moz-full-screen {
            width: 100vw;
            height: 100vh;
        }

        :fullscreen {
            width: 100vw;
            height: 100vh;
        }

        /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è */
        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: white;
            z-index: 5000;
        }

        .connection-status.online {
            background: #27ae60;
        }

        .connection-status.offline {
            background: #e74c3c;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö */
        @media (max-width: 768px) {
            .game-board {
                grid-template-columns: repeat(5, 1fr);
                gap: 5px;
            }
            
            .bottom-panel {
                grid-template-columns: 1fr;
            }
            
            .cell {
                font-size: 16px;
            }
            
            .cell-icon {
                font-size: 18px;
            }
            
            .cell-reps {
                font-size: 10px;
            }
        }
    </style>
    <!-- –î–æ–¥–∞—î–º–æ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div id="gameContainer" style="display: none;">
        <!-- –í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å -->
        <div class="top-bar">
            <div class="game-title">‚ö° –°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –ú–æ–Ω–æ–ø–æ–ª—ñ—è</div>
            <div class="controls">
                <button class="control-btn" id="volumeBtn">üîä</button>
                <button class="control-btn" id="fullscreenBtn">‚õ∂</button>
                <button class="control-btn" id="rulesBtn">üìã</button>
            </div>
        </div>

        <!-- –†—è–¥–æ–∫ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è -->
        <div class="turn-announcement" id="turnAnnouncement">
            –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≥—Ä–∏...
        </div>

        <!-- –Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ -->
        <div class="game-board" id="gameBoard"></div>

        <!-- –ù–∏–∂–Ω—è –ø–∞–Ω–µ–ª—å -->
        <div class="bottom-panel">
            <!-- –°–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ -->
            <div class="players-list">
                <h3>üë• –ì—Ä–∞–≤—Ü—ñ</h3>
                <div id="playersList"></div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –∫—É–±–∏–∫–∞ -->
            <div class="dice-panel">
                <div class="dice" id="dice">
                    <div class="dice-face" id="diceFace"></div>
                </div>
                <div class="last-roll" id="lastRoll"></div>
                <button class="dice-btn" id="rollDiceBtn" disabled>üé≤ –ö–ò–ù–£–¢–ò –ö–£–ë–ò–ö</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤–ø—Ä–∞–≤ -->
    <div class="modal" id="exerciseModal">
        <div class="modal-content">
            <div class="player-info" id="modalPlayerInfo">
                <span class="player-color-dot"></span>
                <span id="modalPlayerName"></span>
            </div>
            <div class="video-container" id="videoContainer"></div>
            <div class="exercise-name" id="exerciseName"></div>
            <div class="reps-container">
                <span class="big-number" id="repetitions">0</span>
                <span class="unit" id="unit">—Ä–∞–∑—ñ–≤</span>
            </div>
            <button class="complete-btn" id="completeExerciseBtn">‚úÖ –í–∏–∫–æ–Ω–∞–≤(–ª–∞)!</button>
            <div class="waiting-message" id="waitingMessage">‚è≥ –ß–µ–∫–∞—î–º–æ –ø–æ–∫–∏ –≥—Ä–∞–≤–µ—Ü—å –≤–∏–∫–æ–Ω—É—î...</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏—Ö –ø–æ–¥—ñ–π -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="player-info" id="eventPlayerInfo">
                <span class="player-color-dot"></span>
                <span id="eventPlayerName"></span>
            </div>
            <div style="font-size: 72px; text-align: center; margin: 20px 0;" id="eventIcon">‚ö°</div>
            <h2 style="text-align: center; margin-bottom: 10px;" id="eventTitle"></h2>
            <p style="text-align: center; margin-bottom: 20px; color: #7f8c8d;" id="eventDescription"></p>
            <button class="complete-btn" id="confirmEventBtn">OK!</button>
        </div>
    </div>

    <!-- –ï–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
    <div class="results-screen" id="resultsScreen">
        <div class="results-content">
            <div id="winnerSection">
                <div class="winner-title" id="winnerName"></div>
            </div>
            <div class="podium" id="podium"></div>
            <table class="stats-table" id="statsTable">
                <thead>
                    <tr>
                        <th>–ì—Ä–∞–≤–µ—Ü—å</th>
                        <th>üèãÔ∏è –ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è</th>
                        <th>üí™ –í—ñ–¥–∂–∏–º–∞–Ω–Ω—è</th>
                        <th>üî• –ë–µ—Ä–ø—ñ</th>
                        <th>ü¶ò –ö–µ–Ω–≥—É—Ä—á–∏–∫–∏</th>
                        <th>üê∏ –ñ–∞–±–∫–∞</th>
                        <th>–í—Å—å–æ–≥–æ</th>
                    </tr>
                </thead>
                <tbody id="statsBody"></tbody>
            </table>
            <button class="new-game-btn" id="newGameBtn">üîÑ –ù–æ–≤–∞ –≥—Ä–∞</button>
        </div>
    </div>

    <!-- –õ–æ–±—ñ (–µ–∫—Ä–∞–Ω –≤—Ö–æ–¥—É) -->
    <div class="lobby-screen" id="lobbyScreen">
        <div class="lobby-content">
            <h1>‚ö° –°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –ú–æ–Ω–æ–ø–æ–ª—ñ—è</h1>
            
            <!-- –í–∏–±—ñ—Ä —Ä–µ–∂–∏–º—É -->
            <div class="mode-selector">
                <button class="mode-btn active" id="sprintModeBtn">üèÜ –°–ø—Ä–∏–Ω—Ç</button>
                <button class="mode-btn" id="marathonModeBtn">üìä –ú–∞—Ä–∞—Ñ–æ–Ω</button>
            </div>
            
            <!-- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é -->
            <div class="input-group">
                <label>–¢–≤—ñ–π –Ω—ñ–∫ (–¥–æ 16 —Å–∏–º–≤–æ–ª—ñ–≤)</label>
                <input type="text" id="playerName" maxlength="16" placeholder="–í–≤–µ–¥–∏ —Å–≤–æ—î —ñ–º'—è">
            </div>

            <div class="input-group">
                <label>–ö–æ–ª—ñ—Ä —Ñ—ñ—à–∫–∏</label>
                <div class="color-picker" id="colorPicker">
                    <!-- –ö–æ–ª—å–æ—Ä–∏ –±—É–¥—É—Ç—å –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ JavaScript -->
                </div>
            </div>

            <!-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏ -->
            <button class="lobby-btn create-btn" id="createRoomBtn">üèüÔ∏è –°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É</button>

            <!-- –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏ -->
            <div class="input-group">
                <label>–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏</label>
                <input type="text" id="roomCode" maxlength="6" placeholder="XXXXXX">
            </div>
            <button class="lobby-btn join-btn" id="joinRoomBtn">üöÄ –ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—å</button>

            <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∫—ñ–º–Ω–∞—Ç—É (–∑'—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è) -->
            <div id="roomInfo" style="display: none;">
                <div class="room-code">
                    <div>–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏:</div>
                    <div class="code" id="displayRoomCode"></div>
                    <button class="copy-btn" id="copyRoomCodeBtn">üìã –ö–æ–ø—ñ—é–≤–∞—Ç–∏</button>
                </div>
                <div class="players-in-room" id="playersInRoom"></div>
                <button class="lobby-btn start-btn" id="startGameBtn" disabled>üöÄ –†–æ–∑–ø–æ—á–∞—Ç–∏ –≥—Ä—É</button>
            </div>

            <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥–ª—è –≥–æ—Å—Ç–µ–π -->
            <div id="waitingMessage" style="display: none;">
                <p style="text-align: center; color: #7f8c8d;">‚è≥ –ß–µ–∫–∞—î–º–æ –ø–æ–∫–∏ –≥–æ—Å–ø–æ–¥–∞—Ä —Ä–æ–∑–ø–æ—á–Ω–µ...</p>
            </div>
        </div>
    </div>

    <!-- –ü–æ–ø–∞–ø –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ -->
    <div class="rules-popup" id="rulesPopup">
        <button class="close-btn" id="closeRulesBtn">‚úï</button>
        <h2>üìã –ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏ "–°–ø–æ—Ä—Ç–∏–≤–Ω–∞ –ú–æ–Ω–æ–ø–æ–ª—ñ—è"</h2>
        
        <h3>üéØ –ú–µ—Ç–∞ –≥—Ä–∏</h3>
        <p>–ü–µ—Ä—à–∏–º –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –¥–æ —Ñ—ñ–Ω—ñ—à—É (–∫–ª—ñ—Ç–∏–Ω–∫–∞ ‚Ññ32) —É —Ä–µ–∂–∏–º—ñ "–°–ø—Ä–∏–Ω—Ç" –∞–±–æ –ø–æ–∫–∞–∑–∞—Ç–∏ –Ω–∞–π–∫—Ä–∞—â–∏–π —á–∞—Å —É —Ä–µ–∂–∏–º—ñ "–ú–∞—Ä–∞—Ñ–æ–Ω".</p>

        <h3>üë• –ì—Ä–∞–≤—Ü—ñ</h3>
        <p>–í—ñ–¥ 2 –¥–æ 21 –≥—Ä–∞–≤—Ü—è. –ö–æ–∂–µ–Ω –≥—Ä–∞–≤–µ—Ü—å –º–∞—î —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π –∫–æ–ª—ñ—Ä —Ñ—ñ—à–∫–∏.</p>

        <h3>üé≤ –Ø–∫ –≥—Ä–∞—Ç–∏</h3>
        <p>1. –ì—Ä–∞–≤—Ü—ñ —Ö–æ–¥—è—Ç—å –ø–æ —á–µ—Ä–∑—ñ.<br>
        2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–ö–∏–Ω—É—Ç–∏ –∫—É–±–∏–∫", —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ —Ö—ñ–¥.<br>
        3. –í–∏–∫–æ–Ω–∞–π—Ç–µ –≤–ø—Ä–∞–≤—É, —è–∫—â–æ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–ª—ñ—Ç–∏–Ω–∫—É.<br>
        4. –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ –º–æ–∂—É—Ç—å –¥–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ö—ñ–¥ –∞–±–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞–∑–∞–¥.</p>

        <h3>üí™ –í–ø—Ä–∞–≤–∏</h3>
        <p><b>üèãÔ∏è –ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è</b> - –Ω–æ–≥–∏ –Ω–∞ —à–∏—Ä–∏–Ω—ñ –ø–ª–µ—á–µ–π, –ø—Ä–∏—Å—ñ–¥–∞—Ç–∏ –¥–æ –∫—É—Ç–∞ 90¬∞.<br>
        <b>üí™ –í—ñ–¥–∂–∏–º–∞–Ω–Ω—è</b> - —É–ø–æ—Ä –ª–µ–∂–∞—á–∏, –∑–≥–∏–Ω–∞—Ç–∏ —Ä—É–∫–∏, —Ç—ñ–ª–æ –ø—Ä—è–º–µ.<br>
        <b>üî• –ë–µ—Ä–ø—ñ</b> - —Å—Ç—Ä–∏–±–æ–∫ –≤ —É–ø–æ—Ä –ª–µ–∂–∞—á–∏, –≤—ñ–¥–∂–∏–º–∞–Ω–Ω—è, —Å—Ç—Ä–∏–±–æ–∫ –≤–≥–æ—Ä—É.<br>
        <b>ü¶ò –ö–µ–Ω–≥—É—Ä—á–∏–∫–∏</b> - —Å—Ç—Ä–∏–±–∫–∏ –Ω–∞ –º—ñ—Å—Ü—ñ, –∫–æ–ª—ñ–Ω–∞ –¥–æ –≥—Ä—É–¥–µ–π.<br>
        <b>üê∏ –ñ–∞–±–∫–∞</b> - –ø—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∑—ñ —Å—Ç—Ä–∏–±–∫–æ–º –≤–≥–æ—Ä—É.</p>

        <h3>üéØ –†–µ–∂–∏–º–∏</h3>
        <p><b>–°–ø—Ä–∏–Ω—Ç</b> - —Ö—Ç–æ –ø–µ—Ä—à–∏–π –¥—ñ–π—à–æ–≤ –¥–æ —Ñ—ñ–Ω—ñ—à—É, —Ç–æ–π –ø–µ—Ä–µ–º—ñ–≥.<br>
        <b>–ú–∞—Ä–∞—Ñ–æ–Ω</b> - –≤—Å—ñ –¥–æ—Ö–æ–¥—è—Ç—å –¥–æ —Ñ—ñ–Ω—ñ—à—É, –±—É–¥—É—î—Ç—å—Å—è —Ä–µ–π—Ç–∏–Ω–≥.</p>

        <h3>üîä –ó–≤—É–∫–∏</h3>
        <p>–ì—Ä–∞ –º–∞—î –∑–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏. –ì—É—á–Ω—ñ—Å—Ç—å —Ä–µ–≥—É–ª—é—î—Ç—å—Å—è –∫–Ω–æ–ø–∫–æ—é üîä.</p>
    </div>

    <!-- –ê—É–¥—ñ–æ –µ–ª–µ–º–µ–Ω—Ç–∏ -->
    <audio id="diceSound" src="https://www.soundjay.com/misc/sounds/dice-roll-1.mp3"></audio>
    <audio id="moveSound" src="https://www.soundjay.com/misc/sounds/move-sound-1.mp3"></audio>
    <audio id="modalSound" src="https://www.soundjay.com/misc/sounds/pop-up-1.mp3"></audio>
    <audio id="winSound" src="https://www.soundjay.com/misc/sounds/fanfare-1.mp3"></audio>

    <!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è -->
    <div class="connection-status online" id="connectionStatus">üü¢ –û–Ω–ª–∞–π–Ω</div>

    <script>
        // ---------- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Firebase ----------
        // –¢–†–ï–ë–ê –ó–ê–ú–Ü–ù–ò–¢–ò –ù–ê –í–ê–®–Ü –î–ê–ù–Ü –ó FIREBASE CONSOLE!
        const firebaseConfig = {
            apiKey: "AIzasyCKZXESKhryYUIZJ4LE_h0oWlwGBxmXpDpg",
            authDomain: "sports-monopoly-1bf13.firebaseapp.com",
            databaseURL: "https://sports-monopoly-1bf13-default-rtdb.firebaseio.com",
            projectId: "sports-monopoly-1bf13",
            storageBucket: "sports-monopoly-1bf13.firebasestorage.app",
            messagingSenderId: "43064795028",
            appId: "1:43064795028:web:b9e74df05c8a988bb1b981"
        };

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ---------- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤—ñ–¥–µ–æ –¥–ª—è –≤–ø—Ä–∞–≤ ----------
        const exerciseVideos = {
            'squat': 'https://www.youtube.com/embed/gsNoPYLcYXI?autoplay=1&loop=1&playlist=gsNoPYLcYXI&controls=0&mute=1&enablejsapi=1',
            'pushup': 'https://www.youtube.com/embed/IODxDxX7oi4?autoplay=1&loop=1&playlist=IODxDxX7oi4&controls=0&mute=1&enablejsapi=1',
            'burpee': 'https://www.youtube.com/embed/qLBImHwCXeo?autoplay=1&loop=1&playlist=qLBImHwCXeo&controls=0&mute=1&enablejsapi=1',
            'kangaroo': 'https://www.youtube.com/embed/jGJ-BzSfcps?autoplay=1&loop=1&playlist=jGJ-BzSfcps&controls=0&mute=1&enablejsapi=1',
            'frog': 'https://www.youtube.com/embed/xmPSllMlHKY?autoplay=1&loop=1&playlist=xmPSllMlHKY&controls=0&mute=1&enablejsapi=1'
        };

        // –ù–∞–∑–≤–∏ –≤–ø—Ä–∞–≤ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é
        const exerciseNames = {
            'squat': 'üèãÔ∏è –ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è',
            'pushup': 'üí™ –í—ñ–¥–∂–∏–º–∞–Ω–Ω—è',
            'burpee': 'üî• –ë–µ—Ä–ø—ñ',
            'kangaroo': 'ü¶ò –ö–µ–Ω–≥—É—Ä—á–∏–∫–∏',
            'frog': 'üê∏ –ñ–∞–±–∫–∞'
        };

        // –û–¥–∏–Ω–∏—Ü—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è
        const exerciseUnits = {
            'squat': '—Ä–∞–∑—ñ–≤',
            'pushup': '—Ä–∞–∑—ñ–≤',
            'burpee': '—Ä–∞–∑—ñ–≤',
            'kangaroo': '—Å—Ç—Ä–∏–±–∫—ñ–≤',
            'frog': '—Ä–∞–∑—ñ–≤'
        };

        // ---------- –î–∞–Ω—ñ —ñ–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è ----------
        const boardCells = [
            { number: 1, type: 'start', icon: 'üèÅ', name: '–°–¢–ê–†–¢', reps: 0 },
            { number: 2, type: 'exercise', exercise: 'squat', icon: 'üèãÔ∏è', name: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è', reps: 7 },
            { number: 3, type: 'exercise', exercise: 'pushup', icon: 'üí™', name: '–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è', reps: 6 },
            { number: 4, type: 'exercise', exercise: 'kangaroo', icon: 'ü¶ò', name: '–ö–µ–Ω–≥—É—Ä—á–∏–∫–∏', reps: 8 },
            { number: 5, type: 'back', value: 3, icon: '‚¨ÖÔ∏è', name: '–ù–∞–∑–∞–¥ 3', reps: 0 },
            { number: 6, type: 'exercise', exercise: 'burpee', icon: 'üî•', name: '–ë–µ—Ä–ø—ñ', reps: 5 },
            { number: 7, type: 'exercise', exercise: 'frog', icon: 'üê∏', name: '–ñ–∞–±–∫–∞', reps: 6 },
            { number: 8, type: 'rest', icon: 'üò¥', name: '–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫', reps: 0 },
            { number: 9, type: 'extra_turn', icon: '‚ö°', name: '–©–µ —Ö—ñ–¥', reps: 0 },
            { number: 10, type: 'skip', icon: 'üõë', name: '–ü—Ä–æ–ø—É—Å–∫', reps: 0 },
            { number: 11, type: 'exercise', exercise: 'squat', icon: 'üèãÔ∏è', name: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è', reps: 9 },
            { number: 12, type: 'exercise', exercise: 'pushup', icon: 'üí™', name: '–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è', reps: 7 },
            { number: 13, type: 'back', value: 5, icon: '‚¨ÖÔ∏è', name: '–ù–∞–∑–∞–¥ 5', reps: 0 },
            { number: 14, type: 'exercise', exercise: 'burpee', icon: 'üî•', name: '–ë–µ—Ä–ø—ñ', reps: 5 },
            { number: 15, type: 'exercise', exercise: 'kangaroo', icon: 'ü¶ò', name: '–ö–µ–Ω–≥—É—Ä—á–∏–∫–∏', reps: 5 },
            { number: 16, type: 'exercise', exercise: 'frog', icon: 'üê∏', name: '–ñ–∞–±–∫–∞', reps: 7 },
            { number: 17, type: 'exercise', exercise: 'squat', icon: 'üèãÔ∏è', name: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è', reps: 5 },
            { number: 18, type: 'back', value: 3, icon: '‚¨ÖÔ∏è', name: '–ù–∞–∑–∞–¥ 3', reps: 0 },
            { number: 19, type: 'exercise', exercise: 'pushup', icon: 'üí™', name: '–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è', reps: 10 },
            { number: 20, type: 'exercise', exercise: 'kangaroo', icon: 'ü¶ò', name: '–ö–µ–Ω–≥—É—Ä—á–∏–∫–∏', reps: 6 },
            { number: 21, type: 'exercise', exercise: 'burpee', icon: 'üî•', name: '–ë–µ—Ä–ø—ñ', reps: 7 },
            { number: 22, type: 'extra_turn', icon: '‚ö°', name: '–©–µ —Ö—ñ–¥', reps: 0 },
            { number: 23, type: 'exercise', exercise: 'frog', icon: 'üê∏', name: '–ñ–∞–±–∫–∞', reps: 8 },
            { number: 24, type: 'rest', icon: 'üò¥', name: '–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫', reps: 0 },
            { number: 25, type: 'skip', icon: 'üõë', name: '–ü—Ä–æ–ø—É—Å–∫', reps: 0 },
            { number: 26, type: 'exercise', exercise: 'kangaroo', icon: 'ü¶ò', name: '–ö–µ–Ω–≥—É—Ä—á–∏–∫–∏', reps: 10 },
            { number: 27, type: 'back', value: 5, icon: '‚¨ÖÔ∏è', name: '–ù–∞–∑–∞–¥ 5', reps: 0 },
            { number: 28, type: 'exercise', exercise: 'pushup', icon: 'üí™', name: '–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è', reps: 5 },
            { number: 29, type: 'exercise', exercise: 'frog', icon: 'üê∏', name: '–ñ–∞–±–∫–∞', reps: 9 },
            { number: 30, type: 'exercise', exercise: 'squat', icon: 'üèãÔ∏è', name: '–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è', reps: 6 },
            { number: 31, type: 'exercise', exercise: 'burpee', icon: 'üî•', name: '–ë–µ—Ä–ø—ñ', reps: 6 },
            { number: 32, type: 'finish', icon: 'üèÜ', name: '–§–Ü–ù–Ü–®', reps: 0 }
        ];

        // ---------- –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ ----------
        let players = [];
        let currentPlayerId = null;
        let gameMode = 'sprint';
        let roomId = null;
        let isHost = false;
        let playerId = null;
        let playerName = '';
        let playerColor = '';
        let availableColors = [
            '#FF5733', '#33FF57', '#3357FF', '#FF33F1', '#33FFF1',
            '#F1FF33', '#FF8333', '#8333FF', '#FF3383', '#33FF83',
            '#8333F1', '#F18333', '#33F183', '#F133FF', '#33F1FF',
            '#FF3333', '#33FF33', '#3333FF', '#FFFF33', '#FF33FF',
            '#33FFFF'
        ];
        let volume = 50;
        let modalActive = false;

        // –ó–≤—É–∫–æ–≤—ñ –µ–ª–µ–º–µ–Ω—Ç–∏
        const diceSound = document.getElementById('diceSound');
        const moveSound = document.getElementById('moveSound');
        const modalSound = document.getElementById('modalSound');
        const winSound = document.getElementById('winSound');

        // ---------- –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è ----------
        document.addEventListener('DOMContentLoaded', () => {
            initLobby();
            renderBoard();
            initControls();
            checkFirebaseConnection();
        });

        // ---------- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase ----------
        function checkFirebaseConnection() {
            const connectedRef = database.ref('.info/connected');
            connectedRef.on('value', (snap) => {
                const status = document.getElementById('connectionStatus');
                if (snap.val() === true) {
                    status.className = 'connection-status online';
                    status.textContent = 'üü¢ –û–Ω–ª–∞–π–Ω';
                } else {
                    status.className = 'connection-status offline';
                    status.textContent = 'üî¥ –û—Ñ–ª–∞–π–Ω';
                }
            });
        }

        // ---------- –§—É–Ω–∫—Ü—ñ—ó –ª–æ–±—ñ ----------
        function initLobby() {
            const colorPicker = document.getElementById('colorPicker');
            colorPicker.innerHTML = '';
            availableColors.forEach((color, index) => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.dataset.index = index;
                colorOption.onclick = () => selectColor(index);
                colorPicker.appendChild(colorOption);
            });
            
            // –í–∏–±–∏—Ä–∞—î–º–æ –ø–µ—Ä—à–∏–π –∫–æ–ª—ñ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
            selectColor(0);
            
            // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º—ñ–≤
            document.getElementById('sprintModeBtn').onclick = () => {
                document.getElementById('sprintModeBtn').classList.add('active');
                document.getElementById('marathonModeBtn').classList.remove('active');
                gameMode = 'sprint';
            };
            
            document.getElementById('marathonModeBtn').onclick = () => {
                document.getElementById('marathonModeBtn').classList.add('active');
                document.getElementById('sprintModeBtn').classList.remove('active');
                gameMode = 'marathon';
            };
        }

        function selectColor(index) {
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.color-option')[index].classList.add('selected');
            playerColor = availableColors[index];
        }

        function getSelectedColor() {
            const selected = document.querySelector('.color-option.selected');
            return selected ? selected.dataset.color : availableColors[0];
        }

        // ---------- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏ ----------
        document.getElementById('createRoomBtn').onclick = async () => {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º\'—è');
                return;
            }

            playerName = name;
            playerColor = getSelectedColor();
            isHost = true;
            roomId = generateRoomCode();
            playerId = 'host_' + Date.now();

            // –°—Ç–≤–æ—Ä—é—î–º–æ –∫—ñ–º–Ω–∞—Ç—É –≤ Firebase
            const roomRef = database.ref('rooms/' + roomId);
            await roomRef.set({
                mode: gameMode,
                host: playerId,
                status: 'waiting',
                currentTurn: null,
                gameState: 'lobby',
                createdAt: firebase.database.ServerValue.TIMESTAMP
            });

            // –î–æ–¥–∞—î–º–æ –≥–æ—Å–ø–æ–¥–∞—Ä—è –¥–æ –≥—Ä–∞–≤—Ü—ñ–≤
            const playersRef = roomRef.child('players');
            await playersRef.child(playerId).set({
                name: playerName,
                color: playerColor,
                position: 1,
                stats: { squat: 0, pushup: 0, burpee: 0, kangaroo: 0, frog: 0 },
                connected: true
            });

            // –ü–æ—á–∏–Ω–∞—î–º–æ —Å–ª—É—Ö–∞—Ç–∏ –∑–º—ñ–Ω–∏
            listenToRoom(roomId);

            // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫—ñ–º–Ω–∞—Ç—É
            document.getElementById('roomInfo').style.display = 'block';
            document.getElementById('displayRoomCode').textContent = roomId;
            document.getElementById('waitingMessage').style.display = 'none';
            
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è
            document.getElementById('createRoomBtn').style.display = 'none';
            document.getElementById('joinRoomBtn').style.display = 'none';
            document.getElementById('roomCode').disabled = true;
        };

        // ---------- –ü—Ä–∏—î–¥–Ω–∞–Ω–Ω—è –¥–æ –∫—ñ–º–Ω–∞—Ç–∏ ----------
        document.getElementById('joinRoomBtn').onclick = async () => {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —ñ–º\'—è');
                return;
            }

            const code = document.getElementById('roomCode').value.trim().toUpperCase();
            if (!code) {
                alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏');
                return;
            }

            playerName = name;
            playerColor = getSelectedColor();
            roomId = code;
            playerId = 'player_' + Date.now();

            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —ñ—Å–Ω—É—î –∫—ñ–º–Ω–∞—Ç–∞
            const roomRef = database.ref('rooms/' + roomId);
            const snapshot = await roomRef.once('value');
            
            if (!snapshot.exists()) {
                alert('–ö—ñ–º–Ω–∞—Ç—É –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                return;
            }

            const roomData = snapshot.val();
            
            // –î–æ–¥–∞—î–º–æ –≥—Ä–∞–≤—Ü—è
            const playersRef = roomRef.child('players');
            await playersRef.child(playerId).set({
                name: playerName,
                color: playerColor,
                position: 1,
                stats: { squat: 0, pushup: 0, burpee: 0, kangaroo: 0, frog: 0 },
                connected: true
            });

            // –ü–æ—á–∏–Ω–∞—î–º–æ —Å–ª—É—Ö–∞—Ç–∏ –∑–º—ñ–Ω–∏
            listenToRoom(roomId);

            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
            document.getElementById('roomInfo').style.display = 'none';
            document.getElementById('waitingMessage').style.display = 'block';
        };

        // ---------- –°–ª—É—Ö–∞—á Firebase ----------
        function listenToRoom(roomId) {
            const roomRef = database.ref('rooms/' + roomId);
            
            // –°–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω–∏ –≤ –≥—Ä–∞–≤—Ü—è—Ö
            roomRef.child('players').on('value', (snapshot) => {
                if (snapshot.exists()) {
                    players = [];
                    snapshot.forEach((childSnapshot) => {
                        const playerData = childSnapshot.val();
                        players.push({
                            id: childSnapshot.key,
                            ...playerData
                        });
                    });
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤ –≤ –ª–æ–±—ñ
                    if (document.getElementById('roomInfo').style.display === 'block') {
                        updatePlayersInRoom();
                    }
                    
                    // –Ø–∫—â–æ –≥—Ä–∞ –ø–æ—á–∞–ª–∞—Å—å, –æ–Ω–æ–≤–ª—é—î–º–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    if (document.getElementById('gameContainer').style.display === 'block') {
                        renderPlayersList();
                        updatePlayerPositions();
                    }
                }
            });

            // –°–ª—É—Ö–∞—î–º–æ —Å—Ç–∞—Ç—É—Å –≥—Ä–∏
            roomRef.child('status').on('value', (snapshot) => {
                if (snapshot.val() === 'playing') {
                    startGameFromFirebase();
                }
            });

            // –°–ª—É—Ö–∞—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π —Ö—ñ–¥
            roomRef.child('currentTurn').on('value', (snapshot) => {
                currentPlayerId = snapshot.val();
                updateTurnAnnouncement();
                updateDiceButton();
            });

            // –°–ª—É—Ö–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞
            roomRef.child('modal').on('value', (snapshot) => {
                const modalData = snapshot.val();
                if (modalData && modalData.active) {
                    if (modalData.type === 'exercise') {
                        showExerciseModalFromFirebase(modalData);
                    } else if (modalData.type === 'event') {
                        showEventModalFromFirebase(modalData);
                    }
                } else {
                    // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞
                    document.getElementById('exerciseModal').style.display = 'none';
                    document.getElementById('eventModal').style.display = 'none';
                    modalActive = false;
                }
            });

            // –°–ª—É—Ö–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏
            roomRef.child('finished').on('value', (snapshot) => {
                if (snapshot.val() === true) {
                    showResultsFromFirebase();
                }
            });
        }

        // ---------- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –≥—Ä–∞–≤—Ü—ñ–≤ –≤ –ª–æ–±—ñ ----------
        function updatePlayersInRoom() {
            const container = document.getElementById('playersInRoom');
            container.innerHTML = '<h4>–ì—Ä–∞–≤—Ü—ñ –≤ –∫—ñ–º–Ω–∞—Ç—ñ:</h4>';
            
            players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = 'player-in-room';
                playerEl.innerHTML = `
                    <div style="width: 20px; height: 20px; border-radius: 50%; background: ${player.color};"></div>
                    <span>${player.name}</span>
                    ${player.connected ? 'üü¢' : 'üî¥'}
                `;
                container.appendChild(playerEl);
            });
            
            // –ê–∫—Ç–∏–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É —Å—Ç–∞—Ä—Ç—É –¥–ª—è –≥–æ—Å–ø–æ–¥–∞—Ä—è
            if (isHost) {
                document.getElementById('startGameBtn').disabled = players.length < 2;
            }
        }

        // ---------- –ü–æ—á–∞—Ç–æ–∫ –≥—Ä–∏ (–≥–æ—Å–ø–æ–¥–∞—Ä) ----------
        document.getElementById('startGameBtn').onclick = async () => {
            if (players.length < 2) return;
            
            const roomRef = database.ref('rooms/' + roomId);
            await roomRef.update({
                status: 'playing',
                currentTurn: players[0].id,
                gameState: 'playing'
            });
        };

        // ---------- –°—Ç–∞—Ä—Ç –≥—Ä–∏ –¥–ª—è –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤ ----------
        function startGameFromFirebase() {
            document.getElementById('lobbyScreen').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            renderBoard();
            renderPlayersList();
            updateTurnAnnouncement();
            updateDiceButton();
        }

        // ---------- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–¥—É –∫—ñ–º–Ω–∞—Ç–∏ ----------
        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // ---------- –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –∫–æ–¥—É ----------
        document.getElementById('copyRoomCodeBtn').onclick = () => {
            navigator.clipboard.writeText(roomId);
            alert('–ö–æ–¥ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!');
        };

        // ---------- –†–µ–Ω–¥–µ—Ä –ø–æ–ª—è ----------
        function renderBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—ñ—Ç–∫—É 3x11 –∑—ñ –∑–º—ñ–π–∫–æ—é
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 11; col++) {
                    let cellIndex;
                    if (row === 0) {
                        cellIndex = 23 + col;
                    } else if (row === 1) {
                        cellIndex = 21 - col;
                    } else {
                        cellIndex = 1 + col;
                    }
                    
                    if (cellIndex <= 32) {
                        const cell = createCell(cellIndex);
                        board.appendChild(cell);
                    }
                }
            }
        }

        function createCell(cellNumber) {
            const cellData = boardCells[cellNumber - 1];
            const cell = document.createElement('div');
            cell.className = 'cell';
            
            if (cellData.type === 'start' || cellData.type === 'finish') {
                cell.classList.add('cell-start');
            } else if (cellData.type === 'exercise') {
                cell.classList.add('cell-exercise');
            } else if (cellData.type === 'extra_turn') {
                cell.classList.add('cell-turn');
            } else {
                cell.classList.add('cell-special');
            }
            
            cell.innerHTML = `
                <span class="cell-number">${cellData.number}</span>
                <span class="cell-icon">${cellData.icon}</span>
                ${cellData.reps > 0 ? `<span class="cell-reps">${cellData.reps}</span>` : ''}
                <div class="players-on-cell" id="cell-${cellData.number}"></div>
            `;
            
            return cell;
        }

        function updatePlayerPositions() {
            // –û—á–∏—â–∞—î–º–æ –≤—Å—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏
            for (let i = 1; i <= 32; i++) {
                const cellDiv = document.getElementById(`cell-${i}`);
                if (cellDiv) {
                    cellDiv.innerHTML = '';
                }
            }
            
            // –î–æ–¥–∞—î–º–æ –≥—Ä–∞–≤—Ü—ñ–≤ –Ω–∞ —ó—Ö–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó
            players.forEach(player => {
                const cellDiv = document.getElementById(`cell-${player.position}`);
                if (cellDiv) {
                    const dot = document.createElement('div');
                    dot.className = 'player-dot';
                    dot.style.backgroundColor = player.color;
                    dot.title = player.name;
                    cellDiv.appendChild(dot);
                }
            });
        }

        function renderPlayersList() {
            const list = document.getElementById('playersList');
            list.innerHTML = '';
            
            players.forEach((player) => {
                const playerEl = document.createElement('div');
                playerEl.className = 'player-item';
                if (player.id === currentPlayerId) {
                    playerEl.classList.add('active');
                }
                
                playerEl.innerHTML = `
                    <div class="player-color" style="background: ${player.color};"></div>
                    <div class="player-name">${player.name}</div>
                    <div class="player-position">–ø–æ–∑–∏—Ü—ñ—è: ${player.position}</div>
                    ${player.id === currentPlayerId ? '<div class="turn-indicator"></div>' : ''}
                `;
                
                list.appendChild(playerEl);
            });
        }

        function updateTurnAnnouncement() {
            const announcement = document.getElementById('turnAnnouncement');
            const currentPlayer = players.find(p => p.id === currentPlayerId);
            
            if (currentPlayer) {
                announcement.textContent = `–•—ñ–¥ –≥—Ä–∞–≤—Ü—è: ${currentPlayer.name}`;
                announcement.style.backgroundColor = currentPlayer.color;
            } else {
                announcement.textContent = '–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
            }
        }

        function updateDiceButton() {
            const rollBtn = document.getElementById('rollDiceBtn');
            const isPlayerTurn = currentPlayerId === playerId && !modalActive;
            
            rollBtn.disabled = !isPlayerTurn;
            
            if (!isPlayerTurn && currentPlayerId) {
                const currentPlayer = players.find(p => p.id === currentPlayerId);
                rollBtn.textContent = `‚è≥ –•—ñ–¥: ${currentPlayer?.name}`;
            } else {
                rollBtn.textContent = 'üé≤ –ö–ò–ù–£–¢–ò –ö–£–ë–ò–ö';
            }
        }

        // ---------- –ö–∏–¥–æ–∫ –∫—É–±–∏–∫–∞ ----------
        document.getElementById('rollDiceBtn').onclick = () => {
            if (currentPlayerId !== playerId || modalActive) return;
            
            playSound(diceSound);
            animateDice();
            
            setTimeout(() => {
                const result = Math.floor(Math.random() * 6) + 1;
                showDiceResult(result);
                
                // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Firebase
                const roomRef = database.ref('rooms/' + roomId);
                roomRef.child('lastRoll').set(result);
                
                // –†—É—Ö–∞—î–º–æ –≥—Ä–∞–≤—Ü—è
                movePlayer(result);
            }, 500);
        };

        function animateDice() {
            const diceFace = document.getElementById('diceFace');
            let frames = 0;
            const interval = setInterval(() => {
                const random = Math.floor(Math.random() * 6) + 1;
                renderDiceFace(random);
                frames++;
                if (frames > 10) {
                    clearInterval(interval);
                }
            }, 50);
        }

        function renderDiceFace(value) {
            const diceFace = document.getElementById('diceFace');
            diceFace.innerHTML = '';
            
            const dots = [];
            for (let i = 0; i < 9; i++) {
                dots.push('<div class="dot empty"></div>');
            }
            
            const positions = {
                1: [4],
                2: [0, 8],
                3: [0, 4, 8],
                4: [0, 2, 6, 8],
                5: [0, 2, 4, 6, 8],
                6: [0, 2, 3, 5, 6, 8]
            };
            
            diceFace.innerHTML = dots.join('');
            positions[value].forEach(pos => {
                diceFace.children[pos].className = 'dot';
            });
        }

        function showDiceResult(value) {
            renderDiceFace(value);
            document.getElementById('lastRoll').textContent = `–û—Å—Ç–∞–Ω–Ω—ñ–π –∫–∏–¥–æ–∫: ${value}`;
        }

        async function movePlayer(steps) {
            const player = players.find(p => p.id === playerId);
            const newPosition = Math.min(32, player.position + steps);
            
            playSound(moveSound);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–∑–∏—Ü—ñ—é –≤ Firebase
            const playerRef = database.ref(`rooms/${roomId}/players/${playerId}`);
            await playerRef.update({ position: newPosition });
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–ª—ñ—Ç–∏–Ω–∫—É
            await checkCell(newPosition);
        }

        async function checkCell(position) {
            const cell = boardCells[position - 1];
            const player = players.find(p => p.id === playerId);
            
            playSound(modalSound);
            modalActive = true;
            
            if (cell.type === 'exercise') {
                // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤—Å—ñ—Ö
                const modalData = {
                    active: true,
                    type: 'exercise',
                    playerId: playerId,
                    playerName: player.name,
                    playerColor: player.color,
                    exercise: cell.exercise,
                    reps: cell.reps,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref(`rooms/${roomId}/modal`).set(modalData);
                
            } else if (cell.type === 'back') {
                const newPosition = Math.max(1, position - cell.value);
                await playerRef.update({ position: newPosition });
                
                const modalData = {
                    active: true,
                    type: 'event',
                    playerId: playerId,
                    playerName: player.name,
                    playerColor: player.color,
                    eventType: 'back',
                    eventValue: cell.value,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref(`rooms/${roomId}/modal`).set(modalData);
                
            } else if (cell.type === 'extra_turn') {
                const modalData = {
                    active: true,
                    type: 'event',
                    playerId: playerId,
                    playerName: player.name,
                    playerColor: player.color,
                    eventType: 'extra_turn',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref(`rooms/${roomId}/modal`).set(modalData);
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ö–æ–¥—É
                await database.ref(`rooms/${roomId}/extraTurn`).set(true);
                
            } else if (cell.type === 'skip') {
                const modalData = {
                    active: true,
                    type: 'event',
                    playerId: playerId,
                    playerName: player.name,
                    playerColor: player.color,
                    eventType: 'skip',
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                };
                
                await database.ref(`rooms/${roomId}/modal`).set(modalData);
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –ø—Ä–æ–ø—É—Å–∫—É
                await database.ref(`rooms/${roomId}/skipNext`).set(true);
                
            } else if (cell.type === 'finish') {
                await finishGame();
            }
        }

        function showExerciseModalFromFirebase(data) {
            const modal = document.getElementById('exerciseModal');
            const videoContainer = document.getElementById('videoContainer');
            
            videoContainer.innerHTML = `
                <iframe src="${exerciseVideos[data.exercise]}"
                        frameborder="0"
                        allow="autoplay; encrypted-media">
                </iframe>
            `;
            
            document.getElementById('modalPlayerName').textContent = data.playerName;
            document.getElementById('modalPlayerInfo').style.backgroundColor = data.playerColor;
            document.getElementById('exerciseName').textContent = exerciseNames[data.exercise];
            document.getElementById('repetitions').textContent = data.reps;
            document.getElementById('unit').textContent = exerciseUnits[data.exercise];
            
            const isActivePlayer = data.playerId === playerId;
            document.getElementById('completeExerciseBtn').style.display = isActivePlayer ? 'block' : 'none';
            document.getElementById('waitingMessage').style.display = isActivePlayer ? 'none' : 'block';
            
            modal.style.display = 'flex';
            modalActive = true;
            
            // –û–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–í–∏–∫–æ–Ω–∞–≤"
            document.getElementById('completeExerciseBtn').onclick = async () => {
                // –î–æ–¥–∞—î–º–æ –¥–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const statsRef = database.ref(`rooms/${roomId}/players/${playerId}/stats/${data.exercise}`);
                await statsRef.set(firebase.database.ServerValue.increment(data.reps));
                
                // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –≤—Å—ñ—Ö
                await database.ref(`rooms/${roomId}/modal`).set({ active: false });
                modal.style.display = 'none';
                modalActive = false;
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
                await nextTurn();
            };
        }

        function showEventModalFromFirebase(data) {
            const modal = document.getElementById('eventModal');
            
            let title, description, icon;
            
            switch(data.eventType) {
                case 'back':
                    icon = '‚¨ÖÔ∏è';
                    title = `–ù–∞–∑–∞–¥ ${data.eventValue}`;
                    description = `${data.playerName} –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –Ω–∞ ${data.eventValue} –∫–ª—ñ—Ç–∏–Ω–∫–∏ –Ω–∞–∑–∞–¥`;
                    break;
                case 'extra_turn':
                    icon = '‚ö°';
                    title = '–©–µ —Ö—ñ–¥!';
                    description = `${data.playerName} –æ—Ç—Ä–∏–º—É—î –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ö—ñ–¥`;
                    break;
                case 'skip':
                    icon = 'üõë';
                    title = '–ü—Ä–æ–ø—É—Å–∫ —Ö–æ–¥—É';
                    description = `–ù–∞—Å—Ç—É–ø–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å –ø—Ä–æ–ø—É—Å–∫–∞—î —Ö—ñ–¥`;
                    break;
            }
            
            document.getElementById('eventPlayerName').textContent = data.playerName;
            document.getElementById('eventPlayerInfo').style.backgroundColor = data.playerColor;
            document.getElementById('eventIcon').textContent = icon;
            document.getElementById('eventTitle').textContent = title;
            document.getElementById('eventDescription').textContent = description;
            
            const isActivePlayer = data.playerId === playerId;
            document.getElementById('confirmEventBtn').disabled = !isActivePlayer;
            
            modal.style.display = 'flex';
            modalActive = true;
            
            document.getElementById('confirmEventBtn').onclick = async () => {
                await database.ref(`rooms/${roomId}/modal`).set({ active: false });
                modal.style.display = 'none';
                modalActive = false;
                await nextTurn();
            };
        }

        async function nextTurn() {
            const roomRef = database.ref('rooms/' + roomId);
            const snapshot = await roomRef.once('value');
            const roomData = snapshot.val();
            
            let nextPlayerIndex;
            const currentIndex = players.findIndex(p => p.id === currentPlayerId);
            
            if (roomData.extraTurn) {
                // –î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ö—ñ–¥
                await roomRef.child('extraTurn').set(false);
                nextPlayerIndex = currentIndex;
            } else {
                if (roomData.skipNext) {
                    // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
                    await roomRef.child('skipNext').set(false);
                    nextPlayerIndex = (currentIndex + 2) % players.length;
                } else {
                    nextPlayerIndex = (currentIndex + 1) % players.length;
                }
            }
            
            const nextPlayerId = players[nextPlayerIndex].id;
            await roomRef.child('currentTurn').set(nextPlayerId);
        }

        async function finishGame() {
            const roomRef = database.ref('rooms/' + roomId);
            
            if (gameMode === 'sprint') {
                // –í —Ä–µ–∂–∏–º—ñ —Å–ø—Ä–∏–Ω—Ç –≥—Ä–∞ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è
                await roomRef.update({
                    finished: true,
                    winner: playerId
                });
            } else {
                // –í —Ä–µ–∂–∏–º—ñ –º–∞—Ä–∞—Ñ–æ–Ω –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—ñ –¥—ñ–π—à–ª–∏
                const allFinished = players.every(p => p.position === 32);
                if (allFinished) {
                    await roomRef.update({
                        finished: true
                    });
                } else {
                    await nextTurn();
                }
            }
        }

        async function showResultsFromFirebase() {
            const roomRef = database.ref('rooms/' + roomId);
            const snapshot = await roomRef.once('value');
            const roomData = snapshot.val();
            
            playSound(winSound);
            
            const resultsScreen = document.getElementById('resultsScreen');
            const winner = players.find(p => p.id === roomData.winner);
            
            if (winner) {
                document.getElementById('winnerName').textContent = `üèÜ ${winner.name} üèÜ`;
            }
            
            // –ë—É–¥—É—î–º–æ —Ç–∞–±–ª–∏—Ü—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            buildStatsTable();
            
            resultsScreen.style.display = 'flex';
        }

        function buildStatsTable() {
            const tbody = document.getElementById('statsBody');
            tbody.innerHTML = '';
            
            players.forEach(player => {
                const row = document.createElement('tr');
                const total = (player.stats.squat || 0) + 
                             (player.stats.pushup || 0) + 
                             (player.stats.burpee || 0) + 
                             (player.stats.kangaroo || 0) + 
                             (player.stats.frog || 0);
                
                row.innerHTML = `
                    <td>${player.name}</td>
                    <td>${player.stats.squat || 0}</td>
                    <td>${player.stats.pushup || 0}</td>
                    <td>${player.stats.burpee || 0}</td>
                    <td>${player.stats.kangaroo || 0}</td>
                    <td>${player.stats.frog || 0}</td>
                    <td>${total}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ---------- –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó ----------
        function initControls() {
            document.getElementById('volumeBtn').onclick = toggleVolume;
            document.getElementById('fullscreenBtn').onclick = toggleFullscreen;
            document.getElementById('rulesBtn').onclick = showRules;
            document.getElementById('closeRulesBtn').onclick = hideRules;
            document.getElementById('newGameBtn').onclick = resetGame;
        }

        function toggleVolume() {
            const btn = document.getElementById('volumeBtn');
            if (volume > 0) {
                volume = 0;
                btn.textContent = 'üîá';
            } else {
                volume = 50;
                btn.textContent = 'üîä';
            }
            
            [diceSound, moveSound, modalSound, winSound].forEach(sound => {
                sound.volume = volume / 100;
            });
        }

        function playSound(sound) {
            sound.volume = volume / 100;
            sound.play().catch(e => console.log('Sound play failed:', e));
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function showRules() {
            document.getElementById('rulesPopup').classList.add('active');
        }

        function hideRules() {
            document.getElementById('rulesPopup').classList.remove('active');
        }

        function resetGame() {
            window.location.reload();
        }
    </script>
</body>
</html>